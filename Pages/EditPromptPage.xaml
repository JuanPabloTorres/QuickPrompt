<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="QuickPrompt.Pages.EditPromptPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:views="clr-namespace:QuickPrompt.Views"
    BackgroundColor="GhostWhite"
    Shell.PresentationMode="Animated">


    <Shell.BackButtonBehavior>
        <BackButtonBehavior IsVisible="False" />
    </Shell.BackButtonBehavior>




    <Shell.TitleView>
        <views:TitleHeader
            Title="Enhance Your Prompt"
            BackCommand="{Binding MyBackCommand}"
            Glyph="&#xe5e0;"
            ShowBackButton="True" />
    </Shell.TitleView>

    <!--  Barra de herramientas  -->
    <ContentPage.ToolbarItems>
        <!--  Botón de Guardar  -->
        <ToolbarItem Command="{Binding UpdateChangesCommand}" IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
            <ToolbarItem.IconImageSource>
                <FontImageSource
                    FontFamily="MaterialIconsOutlined-Regular"
                    Glyph="&#xf232;"
                    Color="{StaticResource PrimaryBlueLight}" />
            </ToolbarItem.IconImageSource>
            <ToolTipProperties.Text>
                Click to Save data
            </ToolTipProperties.Text>
        </ToolbarItem>

        <!--  Botón para resetear posición del botón flotante  -->
        <ToolbarItem Clicked="ResetFloatingButtonPosition">
            <ToolbarItem.IconImageSource>
                <FontImageSource
                    FontFamily="MaterialIconsOutlined-Regular"
                    Glyph="&#xe8aa;"
                    Color="{StaticResource PrimaryBlueDark}" />
            </ToolbarItem.IconImageSource>
            <ToolTipProperties.Text>
                Reset Floating Button Position
            </ToolTipProperties.Text>
        </ToolbarItem>

        <!--  Botón de Crear Variable  -->
        <!--<ToolbarItem Command="{Binding CreateVariableCommand}" IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
            <ToolbarItem.IconImageSource>
                <FontImageSource
                    FontFamily="MaterialIconsOutlined-Regular"
                    Glyph="&#xe86f;"
                    Color="{StaticResource PrimaryBlueLight}" />
            </ToolbarItem.IconImageSource>
        </ToolbarItem>-->
    </ContentPage.ToolbarItems>



    <!--<Grid
            Padding="20"
            RowDefinitions="Auto,Auto,Auto,Auto,Auto"
            RowSpacing="10">

    -->
    <!--  Overlay de carga  -->
    <!--
            <views:ReusableLoadingOverlay
                x:Name="LoadingOverlay"
                Grid.Row="0"
                Grid.RowSpan="5"
                IsVisible="{Binding IsLoading}"
                Message="Loading..." />
            <Label
                Grid.Row="0"
                Style="{StaticResource TitleLabelStyle}"
                Text="Modify Prompt" />

    -->
    <!--  Línea divisoria  -->
    <!--
            <BoxView Grid.Row="1" Style="{StaticResource DividerLineStyle}" />

    -->
    <!--  Entrada para el Título  -->
    <!--
            <Border Grid.Row="2" Style="{StaticResource InputBorderStyle}">
                <Entry
                    IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                    Placeholder="Type Title..."
                    Style="{StaticResource InputEntryStyle}"
                    Text="{Binding PromptTemplate.Title}" />
            </Border>

    -->
    <!--  Entrada para la Descripción  -->
    <!--
            <Border Grid.Row="3" Style="{StaticResource InputBorderStyle}">
                <Editor
                    IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                    Style="{StaticResource InputEditorStyle}"
                    Text="{Binding PromptTemplate.Description}" />
            </Border>

    -->
    <!--  Editor para el Prompt  -->
    <!--
            <Border Grid.Row="4" Style="{StaticResource InputBorderStyle}">
                <Editor
                    CursorPosition="{Binding CursorPosition, Mode=TwoWay}"
                    HeightRequest="300"
                    IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                    Placeholder="Plantilla del Prompt"
                    SelectionLength="{Binding SelectionLength, Mode=TwoWay}"
                    Style="{StaticResource PromptEditorStyle}"
                    Text="{Binding PromptTemplate.Template, Mode=TwoWay}" />
            </Border>
        </Grid>-->

    <AbsoluteLayout>

        <!--  Contenido Principal Scrollable  -->
        <ScrollView AbsoluteLayout.LayoutBounds="0,0,1,1" AbsoluteLayout.LayoutFlags="All">
            <Grid
                Padding="20"
                RowDefinitions="Auto,Auto,Auto,Auto,*,*"
                RowSpacing="10">

                <!--  Overlay de carga  -->
                <views:ReusableLoadingOverlay
                    x:Name="LoadingOverlay"
                    Grid.Row="0"
                    Grid.RowSpan="6"
                    IsVisible="{Binding IsLoading}"
                    Message="Loading..." />

                <!--  Título principal  -->
                <Label
                    Grid.Row="0"
                    Style="{StaticResource TitleLabelStyle}"
                    Text="Prompt Management " />

                <!--  Explicación breve  -->
                <Label
                    Grid.Row="1"
                    FontSize="14"
                    Text="Create your prompt by completing the title, description, and main prompt below. You can insert variables using the floating &lt;&gt; button."
                    TextColor="Gray" />

                <!--  Línea divisoria  -->
                <BoxView Grid.Row="2" Style="{StaticResource DividerLineStyle}" />

                <!--  Campo: Title  -->

                <VerticalStackLayout Grid.Row="3">

                    <Label
                        Grid.Row="3"
                        HorizontalOptions="Start"
                        Style="{StaticResource TitleLabelStyle}"
                        Text="Title " />
                    <Border Grid.Row="3" Style="{StaticResource InputBorderStyle}">
                        <Entry
                            IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                            Placeholder="Example: Blog Post Generator"
                            Style="{StaticResource InputEntryStyle}"
                            Text="{Binding PromptTemplate.Title}" />
                    </Border>
                </VerticalStackLayout>

                <!--  Campo: Description  -->

                <VerticalStackLayout Grid.Row="4">

                    <Label
                        Grid.Row="4"
                        FontSize="14"
                        HorizontalOptions="Start"
                        Style="{StaticResource TitleLabelStyle}"
                        Text="Description (optional) " />
                    <Border Grid.Row="4" Style="{StaticResource InputBorderStyle}">
                        <Editor
                            IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                            Placeholder="Short explanation of what this prompt does..."
                            Style="{StaticResource InputEditorStyle}"
                            Text="{Binding PromptTemplate.Description}" />
                    </Border>
                </VerticalStackLayout>

                <!--  Campo: Prompt  -->
                <VerticalStackLayout Grid.Row="5">

                    <Label
                        Grid.Row="5"
                        HorizontalOptions="Start"
                        Style="{StaticResource TitleLabelStyle}"
                        Text="Prompt Template " />
                    <Border Grid.Row="5" Style="{StaticResource InputBorderStyle}">
                        <Editor
                            CursorPosition="{Binding CursorPosition, Mode=TwoWay}"
                            IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                            Placeholder="Example: Generate a message for &lt;recipient&gt; about &lt;subject&gt;"
                            SelectionLength="{Binding SelectionLength, Mode=TwoWay}"
                            Style="{StaticResource PromptEditorStyle}"
                            Text="{Binding PromptTemplate.Template, Mode=TwoWay}" />
                    </Border>
                </VerticalStackLayout>
            </Grid>

        </ScrollView>

        <!--  Botón flotante  -->
        <Button
            x:Name="FloatingButton"
            Margin="20"
            AbsoluteLayout.LayoutBounds="0,0,50,50"
            AbsoluteLayout.LayoutFlags="None"
            Command="{Binding CreateVariableCommand}"
            IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
            Style="{StaticResource FloatingButtonStyle}">

            <Button.GestureRecognizers>
                <PanGestureRecognizer PanUpdated="OnPanUpdated" />
                <TapGestureRecognizer Tapped="OnFloatingButtonTapped" />
            </Button.GestureRecognizers>

            <Button.ImageSource>
                <FontImageSource
                    FontFamily="MaterialIconsOutlined-Regular"
                    Glyph="&#xe86f;"
                    Color="{StaticResource White}" />
            </Button.ImageSource>
        </Button>
    </AbsoluteLayout>

</ContentPage>