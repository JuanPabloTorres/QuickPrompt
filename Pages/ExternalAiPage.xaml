<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="QuickPrompt.Pages.ExternalAiPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view="clr-namespace:QuickPrompt.Views"
    BackgroundColor="WhiteSmoke"
    Routing.Route="AIWeb">

    <Shell.TitleView>
        <Grid>
            <Label
                FontFamily="Designer"
                FontSize="18"
                Text="AI Web Access"
                TextColor="{StaticResource PrimaryBlueDark}"
                VerticalOptions="Center" />
        </Grid>
    </Shell.TitleView>

    <!--  Barra de herramientas  -->
    <ContentPage.ToolbarItems>

        <ToolbarItem Clicked="onReloadWebView" IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
            <ToolbarItem.IconImageSource>
                <FontImageSource
                    FontFamily="MaterialIconsOutlined-Regular"
                    Glyph="&#xe5d5;"
                    Color="{StaticResource PrimaryYellow}" />
            </ToolbarItem.IconImageSource>
            <ToolTipProperties.Text>
                Click to reload data
            </ToolTipProperties.Text>
        </ToolbarItem>

        <!--  Botón de Copiar  -->
        <ToolbarItem Command="{Binding ClearCommand}" IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
            <ToolbarItem.IconImageSource>
                <FontImageSource
                    FontFamily="MaterialIconsOutlined-Regular"
                    Glyph="&#xe5c9;"
                    Color="{StaticResource PrimaryRed}" />
                <!--  Color asociado al botón Copiar  -->
            </ToolbarItem.IconImageSource>
            <ToolTipProperties.Text>
                Click to Clear Text
            </ToolTipProperties.Text>
        </ToolbarItem>
    </ContentPage.ToolbarItems>

    <Grid
        HorizontalOptions="Fill"
        RowDefinitions="Auto, *"
        VerticalOptions="Fill">

        <!--  Contenedor de botones con Border  -->

        <VerticalStackLayout Grid.Row="0" IsVisible="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
            <ScrollView
                Grid.Row="0"
                HorizontalScrollBarVisibility="Never"
                Orientation="Horizontal">
                <HorizontalStackLayout Grid.Row="0" VerticalOptions="Center">


                    <!--  Botón: ChatGPT  -->
                    <Button
                        Clicked="OnChatGptClicked"
                        Style="{StaticResource AiButtonStyle}"
                        Text="GPT">
                        <Button.ImageSource>
                            <FontImageSource
                                FontFamily="MaterialIconsOutlined-Regular"
                                Glyph="&#xf06c;"
                                Color="White" />
                        </Button.ImageSource>
                    </Button>

                    <!--  Botón: Gemini  -->
                    <Button
                        Clicked="OnGeminiClicked"
                        Style="{StaticResource AiButtonStyle}"
                        Text="Gemini">
                        <Button.ImageSource>
                            <FontImageSource
                                FontFamily="MaterialIconsOutlined-Regular"
                                Glyph="&#xf06c;"
                                Color="White" />
                        </Button.ImageSource>
                    </Button>

                    <!--  Botón: Grok  -->
                    <Button
                        Clicked="OnGrokClicked"
                        Style="{StaticResource AiButtonStyle}"
                        Text="Grok">
                        <Button.ImageSource>
                            <FontImageSource
                                FontFamily="MaterialIconsOutlined-Regular"
                                Glyph="&#xf06c;"
                                Color="White" />
                        </Button.ImageSource>
                    </Button>

                    <!--  Botón: Copilot  -->
                    <Button
                        Clicked="OnCopilotClicked"
                        Style="{StaticResource AiButtonStyle}"
                        Text="Copilot">
                        <Button.ImageSource>
                            <FontImageSource
                                FontFamily="MaterialIconsOutlined-Regular"
                                Glyph="&#xf06c;"
                                Color="White" />
                        </Button.ImageSource>
                    </Button>
                </HorizontalStackLayout>
            </ScrollView>

            <!--  Campo: Categoría  -->
            <VerticalStackLayout Grid.Row="5" Margin="10,0,10,0">
                <Label
                    HorizontalOptions="Start"
                    Style="{StaticResource TitleLabelStyle}"
                    Text="Category" />

                <Border Style="{StaticResource InputBorderStyle}">
                    <Picker
                        Title="Select category"
                        IsEnabled="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                        ItemDisplayBinding="{Binding .}"
                        ItemsSource="{Binding Categories}"
                        SelectedItem="{Binding SelectedCategory, Mode=TwoWay}"
                        Style="{StaticResource InputPickerStyle}" />
                </Border>
            </VerticalStackLayout>

            <CollectionView
                x:Name="FinalPromptsCollection"
                BackgroundColor="Transparent"
                IsVisible="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                ItemsLayout="HorizontalList"
                ItemsSource="{Binding FinalPrompts}"
                SelectionChanged="OnFinalPromptSelected"
                SelectionMode="Single">

                <CollectionView.ItemTemplate>
                    <DataTemplate>

                        <Border Style="{StaticResource CardStyleText}">

                            <VerticalStackLayout>
                                <Label
                                    FontSize="12"
                                    HeightRequest="50"
                                    HorizontalTextAlignment="Center"
                                    LineBreakMode="WordWrap"
                                    MaxLines="5"
                                    Text="{Binding .}"
                                    TextColor="{StaticResource AppBlack}"
                                    VerticalOptions="Center"
                                    WidthRequest="180" />
                            </VerticalStackLayout>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>

        <!--  WebView + Carga  -->
        <Grid
            Grid.Row="1"
            Margin="0,2,0,0"
            IsVisible="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
            <WebView
                x:Name="ExternalAiWebView"
                Navigated="OnNavigated"
                Navigating="OnNavigating"
                Source="about:blank" />
        </Grid>

        <!--  Overlay de carga  -->
        <view:ReusableLoadingOverlay
            x:Name="LoadingIndicator"
            Grid.Row="0"
            Grid.RowSpan="2"
            IsVisible="False"
            Message="Loading..." />
    </Grid>
</ContentPage>