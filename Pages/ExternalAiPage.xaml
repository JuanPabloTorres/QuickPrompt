<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="QuickPrompt.Pages.ExternalAiPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view="clr-namespace:QuickPrompt.Views"
    BackgroundColor="WhiteSmoke"
    Routing.Route="AIWeb">

    <Shell.TitleView>
        <Grid>
            <Label
                FontFamily="Designer"
                FontSize="18"
                Text="AI Web Access"
                TextColor="{StaticResource PrimaryBlueDark}"
                VerticalOptions="Center" />
        </Grid>
    </Shell.TitleView>

    <Grid RowDefinitions="Auto, *">

        <!--  Contenedor de botones con Border  -->

        <VerticalStackLayout Grid.Row="0" IsVisible="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}">
            <ScrollView
                Grid.Row="0"
                HorizontalScrollBarVisibility="Never"
                Orientation="Horizontal">
                <HorizontalStackLayout Grid.Row="0" VerticalOptions="Center">

                    <!--  Bot贸n: ChatGPT  -->
                    <Button
                        Clicked="OnChatGptClicked"
                        Style="{StaticResource AiButtonStyle}"
                        Text="ChatGPT">
                        <Button.ImageSource>
                            <FontImageSource
                                FontFamily="MaterialIconsOutlined-Regular"
                                Glyph="&#xf06c;"
                                Color="White" />
                        </Button.ImageSource>
                    </Button>

                    <!--  Bot贸n: Gemini  -->
                    <Button
                        Clicked="OnGeminiClicked"
                        Style="{StaticResource AiButtonStyle}"
                        Text="Gemini">
                        <Button.ImageSource>
                            <FontImageSource
                                FontFamily="MaterialIconsOutlined-Regular"
                                Glyph="&#xf06c;"
                                Color="White" />
                        </Button.ImageSource>
                    </Button>

                    <!--  Bot贸n: Grok  -->
                    <Button
                        Clicked="OnGrokClicked"
                        Style="{StaticResource AiButtonStyle}"
                        Text="Grok">
                        <Button.ImageSource>
                            <FontImageSource
                                FontFamily="MaterialIconsOutlined-Regular"
                                Glyph="&#xf06c;"
                                Color="White" />
                        </Button.ImageSource>
                    </Button>

                    <!--  Bot贸n: Copilot  -->
                    <Button
                        Clicked="OnCopilotClicked"
                        Style="{StaticResource AiButtonStyle}"
                        Text="Copilot">
                        <Button.ImageSource>
                            <FontImageSource
                                FontFamily="MaterialIconsOutlined-Regular"
                                Glyph="&#xf06c;"
                                Color="White" />
                        </Button.ImageSource>
                    </Button>
                </HorizontalStackLayout>
            </ScrollView>

            <CollectionView
                x:Name="FinalPromptsCollection"
                BackgroundColor="Transparent"
                IsVisible="{Binding IsLoading, Converter={StaticResource InverseBoolConverter}}"
                ItemsLayout="HorizontalList"
                ItemsSource="{Binding FinalPrompts}"
                SelectionChanged="OnFinalPromptSelected"
                SelectionMode="Single">

                <CollectionView.ItemTemplate>
                    <DataTemplate>

                        <Border Style="{StaticResource CardStyleText}">

                            <VerticalStackLayout>
                                <Label
                                    FontSize="12"
                                    HeightRequest="50"
                                    HorizontalTextAlignment="Center"
                                    LineBreakMode="WordWrap"
                                    MaxLines="5"
                                    Text="{Binding .}"
                                    TextColor="{StaticResource AppBlack}"
                                    VerticalOptions="Center"
                                    WidthRequest="180" />

                            </VerticalStackLayout>


                        </Border>

                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>

        <!--  WebView + Carga  -->
        <Grid Grid.Row="1">
            <WebView
                x:Name="ExternalAiWebView"
                Navigated="OnNavigated"
                Navigating="OnNavigating"
                Source="about:blank" />
        </Grid>

        <!--  Overlay de carga  -->
        <view:ReusableLoadingOverlay
            x:Name="LoadingIndicator"
            Grid.Row="0"
            Grid.RowSpan="2"
            Padding="5"
            IsVisible="False"
            Message="Loading..." />
    </Grid>
</ContentPage>