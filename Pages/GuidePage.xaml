<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="QuickPrompt.Pages.GuidePage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:view="clr-namespace:QuickPrompt.Views"
    BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceBackgroundLight}, Dark={StaticResource SurfaceBackgroundDark}}"
    Routing.Route="GuidePage">

    <Shell.BackButtonBehavior>
        <BackButtonBehavior IsVisible="False" />
    </Shell.BackButtonBehavior>

    <Shell.TitleView>
        <view:TitleHeader
            x:Name="titleHeader"
            Title="Quick Start Guide"
            BackCommand="{Binding MyBackCommand}"
            ShowBackButton="false" />
    </Shell.TitleView>

    <Grid RowDefinitions="Auto,*,Auto,Auto" Padding="16">

        <!-- Header -->
        <VerticalStackLayout Grid.Row="0" Spacing="8" Margin="0,0,0,16">
            <Label 
                Text="Welcome to QuickPrompt! ðŸ‘‹" 
                FontSize="24" 
                FontFamily="Nasa21" 
                FontAttributes="Bold"
                TextColor="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}"
                HorizontalTextAlignment="Center" />
            <Label 
                Text="Learn. Create. Reuse. Repeat."
                FontSize="14"
                FontFamily="Nasa21"
                TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"
                HorizontalTextAlignment="Center" />
        </VerticalStackLayout>

        <!-- CarouselView -->
        <CarouselView
            x:Name="GuideCarousel"
            Grid.Row="1"
            IndicatorView="StepIndicator"
            ItemsSource="{Binding GuideSteps}"
            PositionChanged="OnCarouselPositionChanged">
            <CarouselView.ItemTemplate>
                <DataTemplate>
                    <Border 
                        Margin="8"
                        Padding="24"
                        BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceCardLight}, Dark={StaticResource SurfaceCardDark}}"
                        StrokeThickness="0">
                        <Border.StrokeShape>
                            <RoundRectangle CornerRadius="16" />
                        </Border.StrokeShape>
                        <Border.Shadow>
                            <Shadow 
                                Brush="{AppThemeBinding Light={StaticResource AppBlackLight}, Dark=#000000}" 
                                Opacity="0.1" 
                                Radius="10" 
                                Offset="0,4" />
                        </Border.Shadow>

                        <VerticalStackLayout Spacing="16" VerticalOptions="Center">
                            <!-- Step Title -->
                            <Label 
                                Text="{Binding Title}"
                                FontSize="20"
                                FontFamily="Nasa21"
                                FontAttributes="Bold"
                                TextColor="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}"
                                HorizontalTextAlignment="Center" />

                            <!-- Description -->
                            <Label 
                                Text="{Binding Description}"
                                FontSize="15"
                                FontFamily="Nasa21"
                                TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"
                                HorizontalTextAlignment="Center"
                                LineBreakMode="WordWrap" />

                            <!-- Example (if exists) -->
                            <Border
                                Padding="16"
                                BackgroundColor="{AppThemeBinding Light=#EFF6FF, Dark=#1E3A5F}"
                                Stroke="{AppThemeBinding Light=#BFDBFE, Dark=#3B82F6}"
                                StrokeThickness="1"
                                IsVisible="{Binding HasExample}">
                                <Border.StrokeShape><RoundRectangle CornerRadius="8" /></Border.StrokeShape>
                                <Label 
                                    Text="{Binding Example}"
                                    FontSize="14"
                                    FontFamily="Nasa21"
                                    FontAttributes="Italic"
                                    TextColor="{AppThemeBinding Light=#1D4ED8, Dark=#93C5FD}"
                                    HorizontalTextAlignment="Center" />
                            </Border>

                            <!-- CTA Button (final step) -->
                            <Button
                                Margin="0,16,0,0"
                                BackgroundColor="{StaticResource PrimaryRed}"
                                Clicked="OnNavigateToCreatePrompt"
                                CornerRadius="12"
                                FontFamily="Nasa21"
                                FontSize="16"
                                HeightRequest="52"
                                IsVisible="{Binding IsFinalStep}"
                                Text="âš¡ Create Your First Prompt"
                                TextColor="White" />
                        </VerticalStackLayout>
                    </Border>
                </DataTemplate>
            </CarouselView.ItemTemplate>
        </CarouselView>

        <!-- Indicator -->
        <IndicatorView
            x:Name="StepIndicator"
            Grid.Row="2"
            Margin="0,8"
            HorizontalOptions="Center"
            IndicatorColor="{AppThemeBinding Light=#D1D5DB, Dark=#4B5563}"
            SelectedIndicatorColor="{StaticResource PrimaryRed}"
            IndicatorSize="8" />

        <!-- Navigation + Hint -->
        <VerticalStackLayout Grid.Row="3" Spacing="12">
            <Label 
                Text="Swipe or use buttons to navigate"
                FontSize="12"
                FontFamily="Nasa21"
                TextColor="{AppThemeBinding Light={StaticResource TextTertiaryLight}, Dark={StaticResource TextTertiaryDark}}"
                HorizontalTextAlignment="Center" />

            <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                <Button
                    x:Name="BackButton"
                    Grid.Column="0"
                    Clicked="OnBackClicked"
                    Text="â† Back"
                    BackgroundColor="{AppThemeBinding Light=#E5E7EB, Dark=#374151}"
                    TextColor="{AppThemeBinding Light=#374151, Dark=#E5E7EB}"
                    FontFamily="Nasa21"
                    CornerRadius="12"
                    HeightRequest="48" />
                <Button
                    x:Name="NextButton"
                    Grid.Column="1"
                    Clicked="OnNextClicked"
                    Text="Next â†’"
                    BackgroundColor="{StaticResource PrimaryBlue}"
                    TextColor="White"
                    FontFamily="Nasa21"
                    CornerRadius="12"
                    HeightRequest="48" />
            </Grid>
        </VerticalStackLayout>
    </Grid>
</ContentPage>