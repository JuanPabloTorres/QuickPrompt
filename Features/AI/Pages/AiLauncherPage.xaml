<?xml version="1.0" encoding="utf-8" ?>
<ContentPage
    x:Class="QuickPrompt.Features.AI.Pages.AiLauncherPage"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:controls="clr-namespace:QuickPrompt.Controls"
    xmlns:viewModels="clr-namespace:QuickPrompt.ViewModels"
    xmlns:views="clr-namespace:QuickPrompt.Views"
    Title="AI Engines"
    x:DataType="viewModels:AiLauncherViewModel"
    BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceBackgroundLight}, Dark={StaticResource SurfaceBackgroundDark}}">

    <Shell.TitleView>
        <Label
            FontFamily="Nasa21"
            FontSize="18"
            Text="AI Engines"
            TextColor="{StaticResource PrimaryBlueDark}"
            VerticalOptions="Center" />
    </Shell.TitleView>

    <Grid>
        <ScrollView>
            <VerticalStackLayout Padding="16" Spacing="20">

                <!--  âœ… Header Section - Uniform Design  -->
                <Border
                    BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceCardLight}, Dark={StaticResource SurfaceCardDark}}"
                    Stroke="{AppThemeBinding Light={StaticResource BorderLightLight}, Dark={StaticResource BorderLightDark}}"
                    StrokeThickness="1"
                    Padding="16">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    
                    <VerticalStackLayout Spacing="8">
                        <Label
                            FontFamily="Nasa21"
                            FontSize="20"
                            FontAttributes="Bold"
                            Text="ðŸš€ Launch AI Engine"
                            TextColor="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}" />
                        <Label
                            FontFamily="Nasa21"
                            FontSize="14"
                            Opacity="0.8"
                            Text="Select an AI engine to send your prompt"
                            TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}" />
                    </VerticalStackLayout>
                </Border>

                <!--  âœ… AI Providers Section - Uniform Card Design  -->
                <Border
                    BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceCardLight}, Dark={StaticResource SurfaceCardDark}}"
                    Stroke="{AppThemeBinding Light={StaticResource BorderLightLight}, Dark={StaticResource BorderLightDark}}"
                    StrokeThickness="1"
                    Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    
                    <VerticalStackLayout Spacing="0">
                        <!--  Section Header  -->
                        <Label
                            Text="âœ¨ Available Engines"
                            FontFamily="Nasa21"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="{StaticResource PrimaryBlueDark}"
                            Padding="16,16,16,8" />
                        
                        <BoxView
                            HeightRequest="1"
                            Color="{AppThemeBinding Light={StaticResource BorderLightLight}, Dark={StaticResource BorderLightDark}}"
                            Margin="16,0" />
                        
                        <!--  AI Provider Buttons  -->
                        <VerticalStackLayout Spacing="0" Padding="16,12">
                            <!--  ChatGPT  -->
                            <controls:AIProviderButton
                                Command="{Binding LaunchEngineCommand}"
                                CommandParameter="ChatGPT"
                                ProviderColor="#10A37F"
                                ProviderDescription="OpenAI's conversational AI"
                                ProviderMaterialIcon="&#xe0c3;"
                                ProviderName="ChatGPT"
                                ShowArrow="True"
                                ShowDescription="True"
                                ShowMaterialIcon="True"
                                Margin="0,0,0,8" />

                            <!--  Gemini  -->
                            <controls:AIProviderButton
                                Command="{Binding LaunchEngineCommand}"
                                CommandParameter="Gemini"
                                ProviderColor="#8AB4F8"
                                ProviderDescription="Google's multimodal AI"
                                ProviderMaterialIcon="&#xe8b5;"
                                ProviderName="Gemini"
                                ShowArrow="True"
                                ShowDescription="True"
                                ShowMaterialIcon="True"
                                Margin="0,0,0,8" />

                            <!--  Grok  -->
                            <controls:AIProviderButton
                                Command="{Binding LaunchEngineCommand}"
                                CommandParameter="Grok"
                                ProviderColor="#000000"
                                ProviderDescription="X's real-time AI"
                                ProviderMaterialIcon="&#xf06c;"
                                ProviderName="Grok"
                                ShowArrow="True"
                                ShowDescription="True"
                                ShowMaterialIcon="True"
                                Margin="0,0,0,8" />

                            <!--  Copilot  -->
                            <controls:AIProviderButton
                                Command="{Binding LaunchEngineCommand}"
                                CommandParameter="Copilot"
                                ProviderColor="#0078D4"
                                ProviderDescription="Microsoft's AI assistant"
                                ProviderMaterialIcon="&#xe8fd;"
                                ProviderName="Copilot"
                                ShowArrow="True"
                                ShowDescription="True"
                                ShowMaterialIcon="True" />
                        </VerticalStackLayout>
                    </VerticalStackLayout>
                </Border>

                <!--  âœ… Recent Prompts Section - Uniform Card Design with Filter  -->
                <Border
                    BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceCardLight}, Dark={StaticResource SurfaceCardDark}}"
                    Stroke="{AppThemeBinding Light={StaticResource BorderLightLight}, Dark={StaticResource BorderLightDark}}"
                    StrokeThickness="1"
                    Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    
                    <VerticalStackLayout Spacing="0">
                        <!--  Section Header with Clear Button  -->
                        <Grid Padding="16,16,16,8" ColumnDefinitions="*,Auto">
                            <Label
                                Grid.Column="0"
                                Text="ðŸ“‹ Recent Prompts"
                                FontFamily="Nasa21"
                                FontSize="16"
                                FontAttributes="Bold"
                                TextColor="{StaticResource PrimaryBlueDark}"
                                VerticalOptions="Center" />

                            <Button
                                Grid.Column="1"
                                Padding="12,6"
                                BackgroundColor="Transparent"
                                BorderWidth="0"
                                Command="{Binding ClearCommand}"
                                IsVisible="{Binding FinalPrompts.Count, Converter={StaticResource IntToBoolConverter}}"
                                Text="Clear All"
                                FontFamily="Nasa21"
                                FontSize="12"
                                FontAttributes="Bold"
                                TextColor="{StaticResource Danger}"
                                CornerRadius="6" />
                        </Grid>
                        
                        <BoxView
                            HeightRequest="1"
                            Color="{AppThemeBinding Light={StaticResource BorderLightLight}, Dark={StaticResource BorderLightDark}}"
                            Margin="16,0" />
                        
                        <!--  âœ… NEW: Filter by Count  -->
                        <Grid Padding="16,12,16,8" ColumnDefinitions="Auto,*" ColumnSpacing="8"
                              IsVisible="{Binding FinalPrompts.Count, Converter={StaticResource IntToBoolConverter}}">
                            <Label
                                Grid.Column="0"
                                Text="Show:"
                                FontFamily="Nasa21"
                                FontSize="13"
                                TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"
                                VerticalOptions="Center" />
                            
                            <Border
                                Grid.Column="1"
                                BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceInputLight}, Dark={StaticResource SurfaceInputDark}}"
                                Stroke="{AppThemeBinding Light={StaticResource BorderDefaultLight}, Dark={StaticResource BorderDefaultDark}}"
                                StrokeThickness="1"
                                Padding="4,0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <Picker
                                    Title="All Prompts"
                                    ItemsSource="{Binding FilterOptions}"
                                    SelectedItem="{Binding SelectedFilter, Mode=TwoWay}"
                                    FontFamily="Nasa21"
                                    FontSize="13"
                                    TextColor="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}"
                                    TitleColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}"
                                    HeightRequest="38"
                                    VerticalOptions="Center" />
                            </Border>
                        </Grid>
                        
                        <BoxView
                            HeightRequest="1"
                            Color="{AppThemeBinding Light={StaticResource BorderLightLight}, Dark={StaticResource BorderLightDark}}"
                            Margin="16,0"
                            IsVisible="{Binding FinalPrompts.Count, Converter={StaticResource IntToBoolConverter}}" />
                        
                        <!--  Empty State - Improved Design  -->
                        <Border
                            Padding="32,24"
                            BackgroundColor="Transparent"
                            IsVisible="{Binding FinalPrompts.Count, Converter={StaticResource IntToInverseBoolConverter}}"
                            Margin="16">
                            <VerticalStackLayout HorizontalOptions="Center" Spacing="12">
                                <Label
                                    FontFamily="MaterialIconsOutlined-Regular"
                                    FontSize="48"
                                    HorizontalOptions="Center"
                                    Opacity="0.3"
                                    Text="&#xf0eb;"
                                    TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}" />
                                <Label
                                    FontFamily="Nasa21"
                                    FontSize="16"
                                    FontAttributes="Bold"
                                    HorizontalOptions="Center"
                                    Text="No recent prompts"
                                    TextColor="{AppThemeBinding Light={StaticResource TextSecondaryLight}, Dark={StaticResource TextSecondaryDark}}" />
                                <Label
                                    FontFamily="Nasa21"
                                    FontSize="12"
                                    HorizontalOptions="Center"
                                    Opacity="0.7"
                                    Text="Complete a prompt to see it here"
                                    TextColor="{AppThemeBinding Light={StaticResource TextTertiaryLight}, Dark={StaticResource TextTertiaryDark}}" />
                            </VerticalStackLayout>
                        </Border>

                        <!--  Prompts List - Improved Design  -->
                        <CollectionView
                            IsVisible="{Binding FinalPrompts.Count, Converter={StaticResource IntToBoolConverter}}"
                            ItemsSource="{Binding FinalPrompts}"
                            SelectionMode="None"
                            Margin="16,8,16,16">
                            <CollectionView.ItemTemplate>
                                <DataTemplate x:DataType="x:String">
                                    <SwipeView>
                                        <!--  Swipe to Delete  -->
                                        <SwipeView.RightItems>
                                            <SwipeItems Mode="Execute">
                                                <SwipeItem
                                                    BackgroundColor="{StaticResource Danger}"
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:AiLauncherViewModel}}, Path=DeleteFinalPromptCommand}"
                                                    CommandParameter="{Binding .}"
                                                    Text="Delete">
                                                    <SwipeItem.IconImageSource>
                                                        <FontImageSource
                                                            FontFamily="MaterialIconsOutlined"
                                                            Glyph="&#xe92b;"
                                                            Color="White" />
                                                    </SwipeItem.IconImageSource>
                                                </SwipeItem>
                                            </SwipeItems>
                                        </SwipeView.RightItems>

                                        <Border
                                            Margin="0,4"
                                            Padding="16,12"
                                            BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceInputLight}, Dark={StaticResource SurfaceInputDark}}"
                                            Stroke="{AppThemeBinding Light={StaticResource BorderDefaultLight}, Dark={StaticResource BorderDefaultDark}}"
                                            StrokeThickness="1">
                                            <Border.StrokeShape>
                                                <RoundRectangle CornerRadius="8" />
                                            </Border.StrokeShape>

                                            <Border.GestureRecognizers>
                                                <TapGestureRecognizer 
                                                    Command="{Binding Source={RelativeSource AncestorType={x:Type viewModels:AiLauncherViewModel}}, Path=SelectPromptCommand}" 
                                                    CommandParameter="{Binding .}" />
                                            </Border.GestureRecognizers>

                                            <Grid ColumnDefinitions="*,Auto" ColumnSpacing="12">
                                                <Label
                                                    Grid.Column="0"
                                                    LineBreakMode="TailTruncation"
                                                    MaxLines="2"
                                                    FontFamily="Nasa21"
                                                    FontSize="14"
                                                    Text="{Binding .}"
                                                    TextColor="{AppThemeBinding Light={StaticResource TextPrimaryLight}, Dark={StaticResource TextPrimaryDark}}"
                                                    VerticalOptions="Center" />

                                                <Label
                                                    Grid.Column="1"
                                                    FontFamily="MaterialIconsOutlined"
                                                    FontSize="20"
                                                    Text="&#xe5cc;"
                                                    TextColor="{StaticResource PrimaryBlueLight}"
                                                    VerticalOptions="Center" />
                                            </Grid>
                                        </Border>
                                    </SwipeView>
                                </DataTemplate>
                            </CollectionView.ItemTemplate>
                        </CollectionView>
                    </VerticalStackLayout>
                </Border>

                <!--  âœ… Quick Actions Section - Uniform Card Design with FIXED Icons  -->
                <Border
                    BackgroundColor="{AppThemeBinding Light={StaticResource SurfaceCardLight}, Dark={StaticResource SurfaceCardDark}}"
                    Stroke="{AppThemeBinding Light={StaticResource BorderLightLight}, Dark={StaticResource BorderLightDark}}"
                    StrokeThickness="1"
                    Padding="0">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="12" />
                    </Border.StrokeShape>
                    
                    <VerticalStackLayout Spacing="0">
                        <!--  Section Header  -->
                        <Label
                            Text="âš¡ Quick Actions"
                            FontFamily="Nasa21"
                            FontSize="16"
                            FontAttributes="Bold"
                            TextColor="{StaticResource PrimaryBlueDark}"
                            Padding="16,16,16,8" />
                        
                        <BoxView
                            HeightRequest="1"
                            Color="{AppThemeBinding Light={StaticResource BorderLightLight}, Dark={StaticResource BorderLightDark}}"
                            Margin="16,0" />
                        
                        <!--  âœ… FIXED: Action Buttons Grid with Correct FontFamily  -->
                        <Grid Padding="16,12" ColumnDefinitions="*,*" ColumnSpacing="12">
                            <!--  Go to Quick Prompts  -->
                            <Border
                                Grid.Column="0"
                                Padding="16,12"
                                BackgroundColor="{StaticResource PrimaryBlueLight}"
                                StrokeThickness="0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding GoToQuickPromptsCommand}" />
                                </Border.GestureRecognizers>
                                <VerticalStackLayout HorizontalOptions="Center" Spacing="6">
                                    <Label
                                        FontFamily="MaterialIconsOutlined-Regular"
                                        FontSize="28"
                                        HorizontalOptions="Center"
                                        Text="&#xea0b;"
                                        TextColor="White" />
                                    <Label
                                        FontFamily="Nasa21"
                                        FontSize="13"
                                        FontAttributes="Bold"
                                        HorizontalOptions="Center"
                                        Text="Quick"
                                        TextColor="White" />
                                </VerticalStackLayout>
                            </Border>

                            <!--  Go to Create  -->
                            <Border
                                Grid.Column="1"
                                Padding="16,12"
                                BackgroundColor="{StaticResource PrimaryTeal}"
                                StrokeThickness="0">
                                <Border.StrokeShape>
                                    <RoundRectangle CornerRadius="8" />
                                </Border.StrokeShape>
                                <Border.GestureRecognizers>
                                    <TapGestureRecognizer Command="{Binding GoToCreateCommand}" />
                                </Border.GestureRecognizers>
                                <VerticalStackLayout HorizontalOptions="Center" Spacing="6">
                                    <Label
                                        FontFamily="MaterialIconsOutlined-Regular"
                                        FontSize="28"
                                        HorizontalOptions="Center"
                                        Text="&#xe145;"
                                        TextColor="White" />
                                    <Label
                                        FontFamily="Nasa21"
                                        FontSize="13"
                                        FontAttributes="Bold"
                                        HorizontalOptions="Center"
                                        Text="Create"
                                        TextColor="White" />
                                </VerticalStackLayout>
                            </Border>
                        </Grid>
                    </VerticalStackLayout>
                </Border>

            </VerticalStackLayout>
        </ScrollView>

        <!--  âœ… Loading Overlay - Fixed Position  -->
        <views:ReusableLoadingOverlay 
            IsVisible="{Binding IsLoading}"
            HorizontalOptions="Fill"
            VerticalOptions="Fill" />
    </Grid>

</ContentPage>
