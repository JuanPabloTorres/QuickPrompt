<?xml version="1.0" encoding="utf-8" ?>
<ContentView
    x:Class="QuickPrompt.Controls.PromptCard"
    xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
    xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
    xmlns:toolkit="http://schemas.microsoft.com/dotnet/2022/maui/toolkit"
    x:Name="Root">

    <Border
        Margin="8,4"
        Padding="16"
        BackgroundColor="{StaticResource Gray100}"
        StrokeThickness="0">
        <Border.StrokeShape>
            <RoundRectangle CornerRadius="12" />
        </Border.StrokeShape>

        <!--  Shadow Effect  -->
        <Border.Shadow>
            <Shadow
                Brush="{StaticResource AppBlack}"
                Opacity="0.1"
                Radius="8"
                Offset="0,2" />
        </Border.Shadow>

        <!--  Tap Gesture  -->
        <Border.GestureRecognizers>
            <TapGestureRecognizer Command="{Binding TapCommand, Source={x:Reference Root}}" CommandParameter="{Binding BindingContext, Source={x:Reference Root}}" />
        </Border.GestureRecognizers>

        <Grid
            ColumnDefinitions="*,Auto"
            RowDefinitions="Auto,Auto,Auto,Auto"
            RowSpacing="8">

            <!--  Title Row  -->
            <Label
                Grid.Row="0"
                Grid.Column="0"
                FontAttributes="Bold"
                LineBreakMode="TailTruncation"
                MaxLines="2"
                Style="{StaticResource BodyLargeTextStyle}"
                Text="{Binding Title, Source={x:Reference Root}}"
                TextColor="{StaticResource Gray900}" />

            <!--  Favorite Button  -->
            <Button
                Grid.Row="0"
                Grid.Column="1"
                Padding="0"
                BackgroundColor="Transparent"
                Command="{Binding FavoriteCommand, Source={x:Reference Root}}"
                CommandParameter="{Binding BindingContext, Source={x:Reference Root}}"
                FontFamily="MaterialIconsOutlined-Regular"
                FontSize="24"
                HeightRequest="40"
                Text="&#xe87d;"
                TextColor="{Binding IsFavorite, Source={x:Reference Root}, Converter={StaticResource BooleanToStarIconConverter}}"
                VerticalOptions="Start"
                WidthRequest="40" />

            <!--  Description/Preview  -->
            <Label
                Grid.Row="1"
                Grid.Column="0"
                Grid.ColumnSpan="2"
                IsVisible="{Binding ShowDescription, Source={x:Reference Root}}"
                LineBreakMode="TailTruncation"
                MaxLines="2"
                Style="{StaticResource BodySmallTextStyle}"
                Text="{Binding Description, Source={x:Reference Root}}"
                TextColor="{StaticResource Gray600}" />

            <!--  Metadata Row  -->
            <HorizontalStackLayout
                Grid.Row="2"
                Grid.Column="0"
                Grid.ColumnSpan="2"
                Spacing="12">

                <!--  Category Badge  -->
                <Border
                    Padding="8,4"
                    BackgroundColor="{Binding CategoryColor, Source={x:Reference Root}}"
                    IsVisible="{Binding ShowCategory, Source={x:Reference Root}}">
                    <Border.StrokeShape>
                        <RoundRectangle CornerRadius="4" />
                    </Border.StrokeShape>
                    <Label
                        FontAttributes="Bold"
                        Style="{StaticResource CaptionTextStyle}"
                        Text="{Binding Category, Source={x:Reference Root}}"
                        TextColor="White" />
                </Border>

                <!--  Variables Count  -->
                <HorizontalStackLayout IsVisible="{Binding ShowVariableCount, Source={x:Reference Root}}" Spacing="4">
                    <Label
                        FontFamily="MaterialIconsOutlined-Regular"
                        Style="{StaticResource BodyLargeTextStyle}"
                        Text="&#xe3c9;"
                        TextColor="{StaticResource Gray500}"
                        VerticalOptions="Center" />
                    <Label
                        Style="{StaticResource CaptionTextStyle}"
                        Text="{Binding VariableCount, Source={x:Reference Root}, StringFormat='{0} variables'}"
                        TextColor="{StaticResource Gray600}"
                        VerticalOptions="Center" />
                </HorizontalStackLayout>

                <!--  Usage Count  -->
                <HorizontalStackLayout IsVisible="{Binding ShowUsageCount, Source={x:Reference Root}}" Spacing="4">
                    <Label
                        FontFamily="MaterialIconsOutlined-Regular"
                        Style="{StaticResource BodyLargeTextStyle}"
                        Text="&#xe8fd;"
                        TextColor="{StaticResource Gray500}"
                        VerticalOptions="Center" />
                    <Label
                        Style="{StaticResource CaptionTextStyle}"
                        Text="{Binding UsageCount, Source={x:Reference Root}, StringFormat='{0} uses'}"
                        TextColor="{StaticResource Gray600}"
                        VerticalOptions="Center" />
                </HorizontalStackLayout>

            </HorizontalStackLayout>

            <!--  Date/Time  -->
            <Label
                Grid.Row="3"
                Grid.Column="0"
                Grid.ColumnSpan="2"
                IsVisible="{Binding ShowDate, Source={x:Reference Root}}"
                Style="{StaticResource CaptionTextStyle}"
                Text="{Binding DateText, Source={x:Reference Root}}"
                TextColor="{StaticResource Gray500}" />

        </Grid>
    </Border>

</ContentView>
